<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Segnalazione Inviata - HUB Compliance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8fafc; height: 100vh; display: flex; align-items: center; }
        .success-card { border: none; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .ticket-box { 
            background: #fff3cd; 
            border: 2px dashed #ffc107; 
            border-radius: 10px; 
            letter-spacing: 2px;
        }
        .btn-copy { cursor: pointer; transition: 0.2s; }
        .btn-copy:hover { background: #e9ecef; }
    </style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-7 col-lg-6 text-center">
            
            <div class="card success-card p-4 p-md-5">
                <div class="mb-4">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                </div>
                
                <h2 class="fw-bold mb-3">Segnalazione Inviata!</h2>
                <p class="text-muted mb-4">La tua segnalazione è stata registrata con successo nel sistema criptato di HUB Compliance.</p>

                <div class="alert alert-danger mb-4">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>IMPORTANTE:</strong> Non salviamo i tuoi dati personali. Questo codice è l'<strong>unico modo</strong> per consultare l'esito della segnalazione.
                </div>

                <div class="ticket-box p-4 mb-4 position-relative">
                    <small class="text-uppercase fw-bold text-muted">Il tuo Codice Ticket</small>
                    <div class="display-5 fw-bold text-dark my-2 font-monospace" id="ticketCode">{{ codice }}</div>
                    <button class="btn btn-sm btn-outline-dark btn-copy mt-2" onclick="copyCode()">
                        <i class="bi bi-clipboard me-1"></i> Copia Codice
                    </button>
                </div>

                <div class="d-grid gap-2">
                    <a href="{{ status_url }}" class="btn btn-primary btn-lg">
                        Controlla Stato Segnalazione
                    </a>
                    <p class="small text-muted mt-3">Riceverai un riscontro dal Consulente entro i termini previsti dalla Direttiva (UE) 2019/1937.</p>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    function copyCode() {
        const code = document.getElementById('ticketCode').innerText;
        navigator.clipboard.writeText(code).then(() => {
            alert("Codice copiato negli appunti!");
        });
    }
</script>

</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-7 col-lg-6 text-center">
            
            <div class="card success-card p-4 p-md-5">
                <div class="ticket-box p-4 mb-4" id="ticket-area">
                    <small class="text-uppercase fw-bold text-muted">Il tuo Codice Ticket</small>
                    <div class="display-5 fw-bold text-dark my-2 font-monospace" id="ticketCode">{{ codice }}</div>
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" onclick="downloadPDF()">
                        <i class="bi bi-file-earmark-pdf me-2"></i> Scarica Promemoria PDF
                    </button>
                    <a href="{{ status_url }}" class="btn btn-primary btn-lg">
                        Controlla Stato Segnalazione
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

<div id="pdf-template" style="display: none; padding: 40px; font-family: Arial, sans-serif;">
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #002347; padding-bottom: 20px;">
        <div>
            <h1 style="color: #002347; margin: 0;">HUB COMPLIANCE</h1>
            <p style="text-transform: uppercase; font-size: 12px; letter-spacing: 2px; margin: 6px 0 0;">Ricevuta Segnalazione Whistleblowing</p>
        </div>
        <div>
            {% if config and config.logo_principale %}
                <img src="{{ config.logo_principale.url }}" alt="Logo Piattaforma" style="max-height: 60px;">
            {% endif %}
        </div>
    </div>
    
    <div style="margin-top: 40px;">
        <p>In data <strong>{{ segnalazione.data_invio|date:"d/m/Y H:i" }}</strong> è stata depositata una segnalazione sicura per l'azienda <strong>{{ azienda.nome }}</strong>.</p>
        <p>Stato segnalazione: <a href="{{ status_url }}">{{ status_url }}</a></p>
        
        <div style="background: #f8f9fa; border: 1px solid #ddd; padding: 20px; text-align: center; margin: 30px 0;">
            <p style="margin: 0; font-size: 14px; color: #666;">CODICE TICKET UNICO</p>
            <h2 style="margin: 10px 0; font-size: 32px; letter-spacing: 5px; font-family: monospace;">{{ codice }}</h2>
        </div>
        
        <p style="color: #d9534f; font-weight: bold;">ATTENZIONE:</p>
        <p>Conserva questo documento con estrema cura. Senza questo codice non sarà possibile accedere alla risposta del Consulente o fornire ulteriori informazioni in forma anonima.</p>
        
        <p style="margin-top: 50px; font-size: 12px; color: #999; text-align: center;">
            Documento generato automaticamente dal sistema HUB Compliance.<br>
            In ottemperanza alla Direttiva (UE) 2019/1937.
        </p>
    </div>
</div>

<script>
    function downloadPDF() {
        const element = document.getElementById('pdf-template');
        element.style.display = 'block'; // Lo rendiamo visibile un attimo per catturarlo
        
        const opt = {
            margin:       1,
            filename:     'Promemoria_Segnalazione_HUB.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            element.style.display = 'none'; // Lo nascondiamo di nuovo
        });
    }

    function copyCode() {
        const code = document.getElementById('ticketCode').innerText;
        navigator.clipboard.writeText(code).then(() => {
            alert("Codice copiato negli appunti!");
        });
    }
</script>
